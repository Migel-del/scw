location /usa {
    proxy_pass https://backend1;
    proxy_http_version 1.1;

    # TLS + SNI
    proxy_ssl_verify off;
    proxy_ssl_server_name on;
    proxy_ssl_name $host;
    proxy_set_header Host $host;

    # WebSocket Upgrade
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection $connection_upgrade;

    # Таймауты
    proxy_read_timeout 86400;
    proxy_send_timeout 86400;

    # --- Fallback ---
    proxy_next_upstream error timeout invalid_header http_502 http_503 http_504;
    error_page 502 503 504 = @fallback;
}

location @fallback {
    default_type text/plain;
    return 200 "Backend temporarily unavailable\n";
}
